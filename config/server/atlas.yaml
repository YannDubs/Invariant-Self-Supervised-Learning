# @package _global_
defaults:
  - base_submitit
  - override /hydra/launcher: submitit_slurm

hydra:
  launcher:
    partition: atlas
    comment: null
    constraint: null
    exclude: atlas1,atlas2,atlas3,atlas4,atlas5,atlas6,atlas7,atlas8,atlas9,atlas20
    array_parallelism: 30
    max_num_timeout: 3 # allow resume from checkpointing
    additional_parameters:
      gres: gpu:${trainer.gpus}
      #job_name: ${experiment} # to test
      #qos: normal # normal, high, deadline, nopreemption (this is the stream of execution )

# NOTE:
# I also had to change the command in submitit. specifically in submitit/slurm/slurm
# somewhere : /h/yannd/.conda/envs/lossyless/lib/python3.8/site-packages/submitit/slurm/
# function: _make_sbatch_string replace the end with
# lines += [
#       "",
#       "# command",
#       "export SUBMITIT_EXECUTOR=slurm",
#       "export MKL_THREADING_LAYER=GNU",
#       f"srun --mem {mem} --output '{stdout}' --error '{stderr}' --unbuffered {command}",
#   ]
#
# and also had to add slurm to the path
# export PATH="$PATH:/opt/slurm/bin"